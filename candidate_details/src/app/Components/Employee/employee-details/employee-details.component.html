<div class="container mt-4">
  <section class="section profile">
    <div class="row">
      <!-- Profile Image and Info -->
      <div class="col-xl-4">
        <h1 class="text-center magical-header py-2">PROFILE</h1>
        <div class="card border-0 shadow-lg rounded">
          <div
            class="card-body profile-card pt-4 d-flex flex-column align-items-center bg-gradient bg-light rounded"
          >
            <img
              *ngIf="employee.imagePath != null"
              [src]="empImage + employee.imagePath"
              alt="Profile"
              class="rounded-circle border border-primary shadow"
              width="280"
              height="280"
            />
            <img
              *ngIf="employee.imagePath == null"
              src="assets/Image/Default.jpg"
              alt="Profile"
              class="rounded-circle border border-secondary shadow"
              width="280"
              height="280"
            />

            <h2 class="mt-3 text-primary">{{ employee.empName }}</h2>
            <h3 class="text-secondary">{{ employee.empJobTitle }}</h3>
            <h4>Age {{ currentAge }}</h4>
          </div>
        </div>
        <button
          *ngIf="userRole === 'Admin' || userRole === 'HR'"
          class="btn btn-success px-4 mb-2 mt-5"
          routerLink="/employees"
        >
          <i class="fa-solid fa-rotate-left"></i> Employees
        </button>
      </div>

      <!-- Profile Details and Leave -->
      <div class="col-xl-8">
        <div class="card border-0 shadow-lg rounded bg-light">
          <div class="card-body pt-4">
            <!-- Styled Tabs -->
            <ul
              class="nav nav-tabs nav-tabs-bordered justify-content-center border-0"
              role="tablist"
            >
              <li class="nav-item me-2" role="presentation">
                <button
                  class="btn border-secondary px-4 text-uppercase"
                  data-bs-toggle="tab"
                  data-bs-target="#profile-Details"
                  aria-selected="true"
                  role="tab"
                >
                  <i class="fa fa-info-circle fa-lg me-2"></i>
                  Details
                </button>
              </li>

              <li class="nav-item me-2" role="presentation">
                <button
                  class="btn border-secondary text-uppercase px-4"
                  data-bs-toggle="tab"
                  data-bs-target="#profile-Leave"
                  aria-selected="false"
                  tabindex="-1"
                  role="tab"
                >
                  <i class="fa-solid fa-mug-hot fa-lg me-2"></i>leave
                  <span
                    *ngIf="hasLeave(employee.empId)"
                    class="badge bg-danger rounded-circle ms-1 translate-middle"
                    style="width: 8px; height: 8px; padding: 0"
                    >.</span
                  >
                </button>
              </li>

              <li class="nav-item" role="presentation">
                <button
                  class="btn border-secondary text-uppercase px-4"
                  data-bs-toggle="tab"
                  data-bs-target="#profile-password"
                  aria-selected="false"
                  tabindex="-1"
                  role="tab"
                >
                  <i class="fas fa-key fa-lg me-2"></i>Change
                </button>
              </li>
            </ul>

            <div class="tab-content pt-4">
              <!-- Details Tab -->
              <div
                class="tab-pane fade show active"
                id="profile-Details"
                role="tabpanel"
              >
                <h4 class="card-title">Profile Details</h4>
                <hr class="hr" />
                <div class="profile-Details">
                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Name
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empName }}
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Email
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empEmail }}
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Number
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empNumber }}
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Date of birth
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empDateOfBirth | date : "dd-MM-yyyy" }}
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Gender
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empGender }}
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Job Title
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empJobTitle }}
                    </div>
                  </div>

                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Experience
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empExperience }}
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Date of joining
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empDateofJoining | date : "dd-MM-yyyy" }}
                    </div>
                  </div>
                  <div class="row mb-3">
                    <div class="col-lg-3 col-md-4 label fw-bold text-secondary">
                      Address
                    </div>
                    <div class="col-lg-9 col-md-8 text-dark">
                      <i class="me-5">:</i>
                      {{ employee.empAddress }}
                    </div>
                  </div>
                </div>
                <!-- More fields here -->
              </div>

              <!-- Leave Tab -->
              <div
                class="tab-pane fade pt-3 rounded"
                id="profile-Leave"
                role="tabpanel"
              >
                <div>
                  <button
                    *ngIf="!isReqLeave"
                    class="btn btn-primary float-start mb-2"
                    (click)="openModal()"
                  >
                    <i class="fa-solid fa-plus me-1"></i> Leave Request
                  </button>

                  <button
                    *ngIf="userRole != 'Employee' && !isReqLeave"
                    class="btn btn-primary float-end mb-2"
                    (click)="GetRequestLeave(employee.empId)"
                  >
                    <i class="fa-solid fa-info-circle me-1"></i> Requests
                    <span
                      *ngIf="hasLeave(employee.empId)"
                      class="badge bg-danger text-primary rounded-circle ms-1 translate-middle"
                      style="width: 8px; height: 8px; padding: 0"
                      >.</span
                    ></button
                  ><button
                    *ngIf="userRole != 'Employee' && isReqLeave"
                    class="btn btn-primary float-end mb-2"
                    (click)="GetLeave()"
                  >
                    <i class="fa-solid fa-rotate-left me-2"></i>Get Back
                  </button>
                  <table class="table magical-table border">
                    <thead>
                      <tr class="row">
                        <th class="col d-flex justify-content-center">
                          Leave For
                        </th>
                        <th class="col d-flex justify-content-center">
                          Start Date
                        </th>
                        <th class="col d-flex justify-content-center">
                          End Date
                        </th>
                        <th
                          *ngIf="userRole !== 'Employee'"
                          class="col d-flex justify-content-center"
                        >
                          Actions
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr
                        class="row bg-light"
                        *ngFor="let leave of empLeaveList"
                      >
                        <td class="col d-flex justify-content-center">
                          {{ leave.leaveFor }}
                        </td>
                        <td class="col d-flex justify-content-center">
                          {{ leave.startDate | date : "d, MMM, y " }}
                        </td>
                        <td class="col d-flex justify-content-center">
                          {{ leave.endDate | date : "d, MMM, y" }}
                        </td>
                        <td
                          class="col d-flex justify-content-center"
                          *ngIf="userRole !== 'Employee'"
                        >
                          <i
                          [ngClass]="
                          !isReqLeave
                            ? 'fas fa-edit text-primary me-2 cursorPointer'
                            : 'fa-solid fa-thumbs-up text-primary me-2 cursorPointer'
                        "
                            (click)="editLeave(leave)"
                          ></i>
                          <i
                            class="fa fa-trash text-danger cursorPointer"
                            (click)="DeleteLeave(leave.leaveId)"
                          ></i>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <span
                    >Showing {{ firstCandidateOfPage }} to
                    {{ lastCandidateOfPage }} of {{ totalEmpLeave }} Employee
                    Leave.</span
                  >

                  <!-- Pagination Controls -->
                  <nav
                    class="float-end me-4 mt-3"
                    aria-label="Page navigation example"
                    *ngIf="totalpages > 1"
                  >
                    <ul class="pagination">
                      <li
                        class="page-item cursorPointer"
                        [class.disabled]="currentPage === 1"
                      >
                        <a class="page-link" (click)="loadPage(currentPage - 1)"
                          >Previous</a
                        >
                      </li>
                      <li
                        *ngFor="let page of getDisplayedPages()"
                        class="page-item cursorPointer"
                        [class.active]="page === currentPage"
                        [class.disabled]="page === '...'"
                      >
                        <a
                          *ngIf="page !== '...'; else ellipsis"
                          class="page-link cursor-pointer"
                          (click)="loadPage(page)"
                          >{{ page }}</a
                        >
                        <ng-template #ellipsis>
                          <span class="page-link">...</span>
                        </ng-template>
                      </li>
                      <li
                        class="page-item cursorPointer"
                        [class.disabled]="currentPage === totalpages"
                      >
                        <a
                          class="page-link cursor-pointer"
                          (click)="loadPage(currentPage + 1)"
                          >Next</a
                        >
                      </li>
                    </ul>
                  </nav>
                </div>
              </div>

              <!-- Leave Tab -->
              <div
                class="tab-pane fade pt-3 rounded"
                id="profile-password"
                role="tabpanel"
              >
                <form
                  class="p-3"
                  [formGroup]="changePassForm"
                  (ngSubmit)="onChangePasswordSubmit()"
                >
                  <div class="row mb-4">
                    <div class="col-3"></div>
                    <div class="col-6">
                      <label class="form-label" for="currentPassword"
                        >Old Password</label
                      >
                      <div class="input-group">
                        <input
                          [type]="show ? 'text' : 'password'"
                          formControlName="currentPassword"
                          class="form-control magic-input"
                        />
                        <span
                          class="input-group-text password-toggle magic-input"
                          (click)="Show()"
                        >
                          <i
                            [class]="show ? 'fa fa-eye-slash' : 'fa fa-eye'"
                          ></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="row pb-4">
                    <div class="col">
                      <label class="form-label" for="newPassword"
                        >New Password</label
                      >
                      <div class="input-group">
                        <input
                          [type]="showNewPass ? 'text' : 'password'"
                          formControlName="newPassword"
                          class="form-control magic-input"
                        />
                        <span
                          class="input-group-text password-toggle magic-input"
                          (click)="ShowNewPass()"
                        >
                          <i
                            [class]="
                              showNewPass ? 'fa fa-eye-slash' : 'fa fa-eye'
                            "
                          ></i>
                        </span>
                      </div>
                      <small
                        class="text-danger"
                        *ngIf="
                          changePassForm
                            .get('newPassword')
                            ?.hasError('serverError')
                        "
                        >{{ changePassForm.get('newPassword')?.errors?.['serverError'] }}</small
                      ><small
                        *ngIf="
                          shouldShowChangePassError('newPassword') &&
                          !changePassForm.controls['newPassword'].hasError(
                            'pattern'
                          ) &&
                          !changePassForm
                            .get('newPassword')
                            ?.hasError('serverError')
                        "
                        class="text-danger"
                        >Please enter Password.</small
                      >
                      <small
                        class="text-danger"
                        *ngIf="
                          changePassForm.controls['newPassword'].hasError(
                            'pattern'
                          )
                        "
                      >
                        Password must be at least 8 characters long, with an
                        uppercase, lowercase, number, and special character.
                      </small>
                    </div>
                    <div class="col">
                      <label class="form-label" for="newCPassword"
                        >Confirm Password</label
                      >
                      <div class="input-group">
                        <input
                          [type]="showConPassword ? 'text' : 'password'"
                          formControlName="newCPassword"
                          class="form-control magic-input"
                        />
                        <span
                          class="input-group-text password-toggle magic-input"
                          (click)="ShowConPassword()"
                        >
                          <i
                            [class]="
                              showConPassword ? 'fa fa-eye-slash' : 'fa fa-eye'
                            "
                          ></i>
                        </span>
                      </div>
                      <small
                        *ngIf="
                          changePassForm
                            .get('newCPassword')
                            ?.hasError('serverError')
                        "
                        >{{ changePassForm.get('newCPassword')?.errors?.['serverError'] }}</small
                      ><small
                        *ngIf="changePassForm.errors?.['mismatch']||submitted && shouldShowChangePassError('newCPassword')"
                        class="text-danger"
                      >
                        Passwords do not match!</small
                      >
                    </div>
                  </div>
                  <hr class="hr" />
                  <div class="row">
                    <div class="col-12 d-flex justify-content-center">
                      <button type="submit" class="btn btn-primary mt-4">
                        <i class="fa-regular fa-thumbs-up me-1"></i>Change
                      </button>

                      <button
                        type="reset"
                        class="btn btn-danger mt-4 ms-4 shadow-sm"
                      >
                        <i class="fa-solid fa-arrows-rotate me-2"></i> Cancel
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <!-- End Styled Tabs -->
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<ng-template #leaveModal let-modal>
  <div class="modal-header">
    <h4 id="modal-basic-title">{{ LeaveModalHeader }}</h4>
    <button
      type="button"
      class="btn btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="leaveForm" (ngSubmit)="onSubmit()">
      <!-- Form fields -->
      <input type="hidden" formControlName="leaveId" />
      <input type="hidden" formControlName="empId" />

      <div class="row mb-4 m-2">
        <label class="p-0 label" for="leaveFor">Leave For</label>
        <input
          type="text"
          class="form-control magic-input"
          formControlName="leaveFor"
        />
        <small
          class="text-danger"
          *ngIf="
            !leaveForm.get('leaveFor')?.hasError('serverError') &&
            shouldShowError('leaveFor')
          "
        >
          Field is required.
        </small>
        <small
          class="text-danger"
          *ngIf="leaveForm.get('leaveFor')?.hasError('serverError')"
          >{{ leaveForm.get('leaveFor')?.errors?.['serverError'] }}</small
        >
      </div>
      <div class="row mb-4 m-2">
        <label class="p-0 label" for="startDate">Start Date</label>
        <input
          type="date"
          class="form-control magic-input"
          formControlName="startDate"
        /><small
          class="text-danger"
          *ngIf="
            !leaveForm.get('startDate')?.hasError('serverError') &&
            shouldShowError('startDate')
          "
        >
          Field is required.
        </small>
        <small
          class="text-danger"
          *ngIf="leaveForm.get('startDate')?.hasError('serverError')"
          >{{ leaveForm.get('startDate')?.errors?.['serverError'] }}</small
        >
      </div>
      <div class="row mb-4 m-2">
        <label class="p-0 label" for="endDate">End Date</label>
        <input
          type="date"
          class="form-control magic-input"
          formControlName="endDate"
        /><small
          class="text-danger"
          *ngIf="
            !leaveForm.get('endDate')?.hasError('serverError') &&
            shouldShowError('endDate')
          "
        >
          Field is required.
        </small>
        <small
          class="text-danger"
          *ngIf="leaveForm.get('endDate')?.hasError('serverError')"
          >{{ leaveForm.get('endDate')?.errors?.['serverError'] }}</small
        ><small
          class="text-danger"
          *ngIf="leaveForm.hasError('dateRangeInvalid') && leaveForm.touched"
        >
          End date cannot be earlier than start date.
        </small>
      </div>
      <hr class="hr" />
      <div class="row">
        <div class="col-12 d-flex justify-content-center">
          <button type="submit" class="btn btn-primary mt-4">
            <i class="fa-regular fa-thumbs-up me-1"></i>Submit
          </button>

          <button type="reset" class="btn btn-danger mt-4 ms-4 shadow-sm">
            <i class="fa-solid fa-arrows-rotate me-2"></i> Reset
          </button>
        </div>
      </div>
    </form>
  </div>
</ng-template>
